<?xml version="1.0" encoding="ISO-8859-1"?>

<!-- This file contains the definition of the first page of the standard character
      sheet for output. The character sheet has been carved into a simple two-column
      presentation that is used by many game systems, with some information on the
      left and other material on the right. You can use whatever overall layout you
      prefer, using this sample as a guideline.

      A variety of display techniques have been used on this one character sheet to
      provide examples of how to present information in different ways. You will
      likely choose one or two of these methods and use them exclusively within your
      own data files, but this gives you various styles to choose from.

      The second page of the character sheet will be found in "sheet_standard2.dat".
-->

<document signature="Hero Lab Data">
  
  <!-- oTianLogo portal - game system logo -->
  <portal
    id="oTianLogo"
    style="outNormal"
    width="0"
    height="0">
    <output_image
      image="sheet_tianlogo.bmp">
      </output_image>
    </portal>
    
  <!-- oHeroName portal - name of the actor -->
  <portal
    id="oTianName"
    style="outTianHea">
    <output_label>
      <labeltext><![CDATA[
        @text = hero.actorname
        if (empty(@text) <> 0) then
          @text = "- Unnamed Hero -"
          endif
        ]]></labeltext>
      </output_label>
    </portal>
    
  <!-- oTianRefr portal - Refresh Rate for the actor -->
  <portal
    id="oTianRefr"
    style="outTianLft">
    <output_label>
      <labeltext><![CDATA[
        @text = "Refresh Rate: " & herofield[acFateRefR].value
        ]]></labeltext>
      </output_label>
    </portal>
    
  <!-- oTianJian portal - Jianghu Rank for the actor -->
  <portal
    id="oTianJian"
    style="outHeaderB">
    <output_label>
      <labeltext><![CDATA[
        @text = "Jianghu Rank: " & hero.tagcount[Jianghu.Rank]
        ]]></labeltext>
      </output_label>
    </portal>
            
  <portal
    id="oTianPers"
    style="outNormal">
    <output_table
      component="Personal"
      showtemplate="oTianInfo"
      varyheight="yes">
      <list><![CDATA[
        !Helper.NoPersText & hero#source.ShowDetail
        ]]></list>
      <headertitle><![CDATA[
        @text = "Background"
        ]]></headertitle>
      </output_table>
    </portal>

  <!-- oTianStnt portal
        This is a table of all Stunts, excluding Forms and techniques for the actor.
  -->
  <portal
    id="oTianStnt"
    style="outNormal">
    <output_table
      component="Stunt"
      showtemplate="oStntPick"
      varyheight="yes">
      <list><![CDATA[
        !Tianxia.Form & !Tianxia.Tech
        ]]></list>
      <headertitle><![CDATA[
        @text = "Stunts"
        ]]></headertitle>
      </output_table>
    </portal>
    
  <!-- oTianForm portal
        This is a table of all Stunts, excluding Forms and techniques for the actor.
  -->
  <portal
    id="oTianForm"
    style="outNormal">
    <output_table
      component="Form"
      showtemplate="oFormPick"
      varyheight="yes">
      <list><![CDATA[
        Tianxia.Form
        ]]></list>
      <headertitle><![CDATA[
        @text = "Kung Fu Form"
        ]]></headertitle>
      </output_table>
    </portal>
    
  <!-- oTianTech portal
        This is a table of all Stunts, excluding Forms and techniques for the actor.
  -->
  <portal
    id="oTianTech"
    style="outNormal">
    <output_table
      component="Tech"
      showtemplate="oTechPick"
      varyheight="yes">
      <list><![CDATA[
        Tianxia.Tech
        ]]></list>
      </output_table>
    </portal>
    
  <!-- oTianTec2 portal
        This is a table of all Stunts, excluding Forms and techniques for the actor.
  -->
  <portal
    id="oTianTec2"
    style="outNormal">
    <output_table
      component="Tech"
      showtemplate="oTechPick"
      varyheight="yes">
      <list><![CDATA[
        Tianxia.Tech
        ]]></list>
      </output_table>
    </portal>
    
  <!-- oTianAsp portal
        This is a table of all Aspects.
  -->
  <portal
    id="oTianAsp"
    style="outNormal">
    <output_table
      component="Aspect"
      showtemplate="oAspPick">
      <list><![CDATA[
      !thingid.aspTrouble & !thingid.aspHighCon
        ]]></list>
      </output_table>
    </portal>
    
  <!-- oTianTro portal
        This is a table of Trouble Aspects.
  -->
  <portal
    id="oTianTro"
    style="outNormal">
    <output_table
      component="Aspect"
      showtemplate="oAspPick">
      <list><![CDATA[
      thingid.aspTrouble
        ]]></list>
      </output_table>
    </portal> 

  <!-- oTianHC portal
        This is a table of High Concept Aspects.
  -->
  <portal
    id="oTianHC"
    style="outNormal">
    <output_table
      component="Aspect"
      showtemplate="oAspPick">
      <list><![CDATA[
      thingid.aspHighCon
        ]]></list>
      </output_table>
    </portal>
    
    <portal
      id="hdrAspect"
      style="outHeaderA">
      <output_label>
        <labeltext><![CDATA[
          @text = "Aspects"
          ]]></labeltext>
        </output_label>
      </portal>
                 
  <!-- oInfo template
        This template presents the character info, from the Personal tab.
  -->
  <template
    id="oTianInfo"
    name="Output Info"
    compset="Personal">

    <portal
      id="info"
      style="outPlainLt">
      <output_label
        field="perInfo">
        </output_label>
      </portal>

    <position><![CDATA[
      ~size the name to fit the available space
      portal[info].width = width
      perform portal[info].autoheight

      ~our height is the vertical extent of our portal
      height = portal[info].textheight
      ]]></position>

    </template>
    
  <template
    id="oFormPick"
    name="Output Forms Table"
    compset="Form"
    marginvert="2">

    <portal
      id="details"
      style="outTianLft">
      <output_label
        ismultiline="yes">
        <labeltext><![CDATA[
          @text = "{b}" & field[name].text & " Form {/b}"
          ]]></labeltext>
        </output_label>
      </portal>

    <position><![CDATA[
      ~our details width spans the entire template width
      portal[details].width = width

      ~limit our portal height to a single line of output
      ~portal[details].lineheight = 3
      perform portal[details].autoheight

      ~our height is the height of our portal
      height = portal[details].bottom
      ]]></position>
    </template>

  <template
    id="oTechPick"
    name="Output Techniques Table"
    compset="Tech"
    marginvert="2">

    <portal
      id="details"
      style="outTianLft">
      <output_label
        ismultiline="yes">
        <labeltext><![CDATA[
          @text = "{b}" & field[name].text & " {/b}" & field[descript].text
          ]]></labeltext>
        </output_label>
      </portal>

    <position><![CDATA[
      ~our details width spans the entire template width
      portal[details].width = width

      ~limit our portal height to a single line of output
      ~portal[details].lineheight = 3
      perform portal[details].autoheight

      ~our height is the height of our portal
      height = portal[details].bottom
      ]]></position>
    </template>
            
  <template
    id="oStntPick"
    name="Output Stunts Table"
    compset="Stunt"
    marginvert="2">

    <portal
      id="details"
      style="outTianLft">
      <output_label
        ismultiline="yes">
        <labeltext><![CDATA[
          @text = "{b}" & field[name].text & "{/b}  (" & field[UserText].text & ")"
          ]]></labeltext>
        </output_label>
      </portal>

    <position><![CDATA[
      ~our details width spans the entire template width
      portal[details].width = width

      ~limit our portal height to a single line of output
      ~portal[details].lineheight = 3
      perform portal[details].autoheight

      ~our height is the height of our portal
      height = portal[details].bottom
      ]]></position>
    </template>

  
  <template
    id="oAspPick"
    name="Output Aspects Table"
    compset="Aspect"
    marginvert="2">

    <portal
      id="details"
      style="outTianLft">
      <output_label>
        <labeltext><![CDATA[
          @text = "{b}" & field[name].text & "{/b}"
          ]]></labeltext>
        </output_label>
      </portal>

    <position><![CDATA[
      ~our details width spans the entire template width
      portal[details].width = width

      ~limit our portal height to a single line of output
      ~portal[details].lineheight = 3
      perform portal[details].autoheight

      ~our height is the height of our portal
      height = portal[details].bottom
      ]]></position>
    </template>

  <!-- oLogos layout
        This layout sizes and positions the Hero Lab and game system logos. The logos
        can be either stacked or shown side-by-side, based on the global variable set
        within the sheet script.
  -->
  <layout
    id="oTianLogos">
    <portalref portal="oHLLogo"/>
    <portalref portal="oTianLogo"/>
    <position><![CDATA[
      var temp as number
      var logogap as number
      var scale as number

      ~if our logos are stacked, scale them for stacked orientation
      if (scenevalue[stacklogos] <> 0) then
        logogap = 20
        scale = 1.8

      ~otherwise, scale our logos for side by side orientation
      else
        logogap = 40
        temp = portal[oTianLogo].width + portal[oHLLogo].width
        scale = (width - logogap) / temp
        if (scale > 2.0) then
          scale = 2.0
          endif
        endif

      ~scale both logos appropriately
      portal[oTianLogo].width *= scale
      portal[oTianLogo].height *= scale
      portal[oHLLogo].width *= scale
      portal[oHLLogo].height *= scale

      ~if our logos are stacked, position them properly
      if (scenevalue[stacklogos] <> 0) then

        ~position the logos horizontally
        perform portal[oTianLogo].centerhorz
        perform portal[oHLLogo].centerhorz

        ~position the Hero Lab logo beneath the game system logo
        perform portal[oHLLogo].alignrel[ttob,oTianLogo,logogap]

        ~our total height is the bottom of the lower logo
        height = portal[oHLLogo].bottom

      ~ Otherwise, position them side by side
      else

        ~position the logos horizontally, centering them together in the space
        temp = portal[oTianLogo].width + portal[oHLLogo].width
        temp = (width - temp - logogap) / 2
        portal[oTianLogo].left = temp
        perform portal[oHLLogo].alignrel[ltor,oTianLogo,logogap]

        ~our total height is the bottom of the tallest logo
        height = maximum(portal[oHLLogo].height,portal[oTianLogo].height)

        ~center the logos vertically
        perform portal[oTianLogo].centervert
        perform portal[oHLLogo].centervert
        endif
      ]]></position>
    </layout>
                       
  <!-- oHeader layout
        This layout is rendered across the top of the sheet and contains the
        name for the character.
  -->
  <layout
    id="oHeader">
    <portalref portal="oTianName"/>
    <position><![CDATA[
      ~position the hero name at the top with the hero details beneath the name
      perform portal[oTianName].autoplace[0]

      ~position the tables next
      ~perform portal[oAttribute].autoplace
      ~perform portal[oPower].autoplace
      ~perform portal[oDerived].autoplace

      ~our layout height is the extent of the elements within
      height = autoextent
      ]]></position>
    </layout>    
    
  <layout
    id="oPortrait">
    <templateref template="oPortrait" thing="actor"/>
    <position><![CDATA[
      ~position the character portrait at the top and the various tables beneath
      perform template[oPortrait].autoplace

      ~our layout height is the extent of the elements within
      height = autoextent
      ]]></position>
    </layout>
    
  <!-- oTianRight layout
        This layout is rendered down the middle of the sheet and contains the
        Stunts, Refresh rate and personal info.
  -->
  <layout
    id="oTianRight">
    <portalref portal="oTianTec2" />    
    <portalref portal="oTianStnt" />    
    <portalref portal="oTianRefr" />    
    <portalref portal="oTianPers" />
    <position><![CDATA[
      ~position the character stunts at the top and the various other beneath
      perform portal[oTianTec2].autoplace
      perform portal[oTianStnt].autoplace
      perform portal[oTianRefr].autoplace
      perform portal[oTianPers].autoplace

      ~our layout height is the extent of the elements within
      height = autoextent
      ]]></position>
    </layout>
    
  <!-- oTianLeft layout
        This layout is rendered down the left side of the sheet and contains   
        the Aspects, Skills, Jianghu and Kungfu Forms/echniques
  -->
  <layout
    id="oTianLeft">
    <portalref portal="hdrAspect" />    
    <portalref portal="oTianHC" />    
    <portalref portal="oTianTro" />    
    <portalref portal="oTianAsp" />    
    <portalref portal="oSkills" />    
    <portalref portal="oStress" />    
    <portalref portal="oTianJian" />    
    <portalref portal="oTianForm" />    
    <portalref portal="oTianTech" />    
    <position><![CDATA[
      ~position the character stunts at the top and the various other beneath
      perform portal[hdrAspect].autoplace
      perform portal[oTianHC].autoplace
      perform portal[oTianTro].autoplace
      perform portal[oTianAsp].autoplace
      perform portal[oSkills].autoplace
      perform portal[oStress].autoplace
      perform portal[oTianJian].autoplace
      perform portal[oTianForm].autoplace
      perform portal[oTianTech].autoplace

      ~our layout height is the extent of the elements within
      height = autoextent
      ]]></position>
    </layout>
            
  <!-- tianxia1 sheet
        This is the first page of the stanard character sheet, which coordinates the
        output of a whole bunch of layouts containing different pieces of information
        for the character. Layouts are estimated to perform whatever calculations are
        necessary within that layout, such as its overall dimensions. Once estimated,
        the dimensions of the layout can be used to properly position and size any
        subsequent layouts that depend on it. So the overall process is to process
        layouts in an order that progressively fills the sheet with aligned material.
  -->
  <sheet
    id="tianxia1"
    name="Tianxia character sheet, page #1">
    <layoutref layout="oHeader"/>
    <layoutref layout="oTianLogos"/>
    <layoutref layout="oTianLeft"/>
    <layoutref layout="oTianRight"/>
    <layoutref layout="oPortrait"/>
    <layoutref layout="oAdjust"/>
    <layoutref layout="oValidate"/>
    <position><![CDATA[
      ~set this global variable to 1 if you want the logos to be stacked; a value
      ~of zero places them side-by-side
      scenevalue[stacklogos] = 0

      ~setup the gap to be used between the various sections of the character sheet
      autogap = 15
      scenevalue[sectiongap] = autogap

      ~calculate the width of the two columns of the character sheet, leaving a
      ~suitable center gap between them
      var colwidth as number
      colwidth = (width - 30) / 3

      ~if the user wants to omit the validation report, the hide it and allow the
      ~rest of the sheet to fill that space; otherwise, output the layout and the
      ~top of the validation report establishes the bottom for all other output
      var extent as number
      if (hero.tagis[source.Validation] = 0) then
        layout[oValidate].visible = 0
        extent = height
      else
        layout[oValidate].width = width
        perform layout[oValidate].render
        layout[oValidate].top = height - layout[oValidate].height
        extent = layout[oValidate].top - autogap
        endif

      ~position the name across the top
      layout[oHeader].width = width
      layout[oHeader].height = 40
      perform layout[oHeader].render
      
      ~position the leftside layout in the upper left corner
      layout[oTianLeft].width = colwidth
      layout[oTianLeft].top = layout[oHeader].bottom + autogap
      layout[oTianLeft].height = extent - layout[oTianLeft].top
      perform layout[oTianLeft].render

      ~position the activated adjustments at the bottom on the left; this will
      ~establish the remaining space available on the left for armor and weapons
      layout[oAdjust].width = colwidth
      perform layout[oAdjust].render
      layout[oAdjust].top = extent - layout[oAdjust].height

      ~position the rightside layout in the middle
      layout[oTianRight].width = colwidth
      layout[oTianRight].top = layout[oTianLeft].top 
      layout[oTianRight].left = layout[oTianLeft].right + autogap
      layout[oTianRight].height = extent - layout[oTianRight].top
      perform layout[oTianRight].render
      
      ~position the logos layout in the upper right corner
      layout[oTianLogos].width = colwidth
      perform layout[oTianLogos].render
      layout[oTianLogos].left = width - colwidth

      ~position the rightside layout in the remaining space on the right
      layout[oPortrait].width = colwidth
      layout[oPortrait].top = layout[oTianLogos].bottom + autogap
      layout[oPortrait].left = layout[oTianLogos].left
      layout[oPortrait].height = extent - layout[oPortrait].top
      perform layout[oPortrait].render
      
      ]]></position>
    </sheet>

  </document>
